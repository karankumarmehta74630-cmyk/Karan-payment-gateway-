<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karan Payment Gateway</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
background:linear-gradient(135deg,#0f172a,#1e3a8a);
color:#fff;
min-height:100vh;
padding:20px;
display:flex;
justify-content:center;
}

.container{max-width:450px;width:100%}

.card{
background:#fff;
color:#000;
border-radius:12px;
padding:20px;
box-shadow:0 20px 40px rgba(0,0,0,0.2);
margin-bottom:20px;
}

.header{
background:#1e40af;
color:#fff;
padding:12px;
border-radius:8px;
text-align:center;
font-weight:600;
margin-bottom:15px;
}

input{
width:100%;
padding:10px;
margin-top:10px;
border:1px solid #ccc;
border-radius:6px;
}

button{
width:100%;
padding:10px;
margin-top:10px;
border:none;
border-radius:6px;
background:#1e40af;
color:#fff;
cursor:pointer;
font-weight:600;
}

button:hover{opacity:.9}

#qrSection{display:none;text-align:center}

.timer{color:red;font-weight:600;margin-top:6px}

.link-box{
background:#f1f5f9;
padding:8px;
border-radius:6px;
font-size:12px;
margin-top:8px;
word-break:break-all;
}

.history-card{
background:#f1f5f9;
padding:8px;
border-radius:8px;
margin-top:8px;
font-size:13px;
}

.nav{
display:flex;
gap:10px;
margin-bottom:15px;
}

.nav button{background:#9333ea}

.hidden{display:none}
</style>
</head>
<body>

<div class="container">

<div class="nav">
<button onclick="showPage('payment')">Payment</button>
<button onclick="showPage('history')">History</button>
</div>

<div id="paymentPage" class="card">

<div class="header">Karan Payment Gateway</div>

<input type="number" id="amountInput" placeholder="Enter Amount ₹">

<button onclick="generateLink()">Generate Payment Link</button>

<div id="generatedLink" class="link-box"></div>

<div id="qrSection">

<div id="qrcode"></div>

<p id="orderText"></p>
<p id="amountText"></p>
<p class="timer" id="timer"></p>

<button onclick="downloadQR()">Download QR</button>
<button onclick="sharePayment()">Share QR + Link</button>
<button onclick="saveHistory()">Mark as Paid</button>

</div>

</div>

<div id="historyPage" class="card hidden">
<h3>Payment History</h3>
<div id="historyList"></div>
</div>

</div>

<script>

let baseURL=window.location.origin+window.location.pathname;
let orderId="";
let currentAmount="";
let countdown;
let timeLeft=60;

function showPage(page){
document.getElementById("paymentPage").classList.add("hidden");
document.getElementById("historyPage").classList.add("hidden");

if(page==="payment"){
document.getElementById("paymentPage").classList.remove("hidden");
}else{
document.getElementById("historyPage").classList.remove("hidden");
loadHistory();
}
}

function getURLAmount(){
let params=new URLSearchParams(window.location.search);
return params.get("amount");
}

window.onload=function(){
let amt=getURLAmount();
if(amt && amt>0){
document.getElementById("amountInput").value=amt;
generateQR(amt);
}
loadHistory();
}

function generateLink(){

let amt=document.getElementById("amountInput").value;

if(!amt || amt<=0){
alert("Enter valid amount");
return;
}

let paymentLink=baseURL+"?amount="+amt;

document.getElementById("generatedLink").innerText=paymentLink;

generateQR(amt);
}

function generateQR(amount){

currentAmount=amount;
orderId="ORD"+Date.now();

document.getElementById("qrSection").style.display="block";
document.getElementById("orderText").innerText="Order ID: "+orderId;
document.getElementById("amountText").innerText="Amount to Pay: ₹"+amount;

let upiLink="upi://pay?pa=7463011305-14@ybl&pn=Karan&am="+amount+"&cu=INR&tn=Order "+orderId;

document.getElementById("qrcode").innerHTML="";
new QRCode(document.getElementById("qrcode"),{
text: upiLink,
width:200,
height:200
});

startTimer();
}

function startTimer(){
timeLeft=60;
updateTimer();
clearInterval(countdown);

countdown=setInterval(()=>{
timeLeft--;
updateTimer();
if(timeLeft<=0){
clearInterval(countdown);
document.getElementById("timer").innerText="Expired";
}
},1000);
}

function updateTimer(){
document.getElementById("timer").innerText="Expires in "+timeLeft+" sec";
}

function downloadQR(){
let canvas=document.querySelector("#qrcode canvas");
let link=document.createElement("a");
link.href=canvas.toDataURL("image/png");
link.download="QR_"+orderId+".png";
link.click();
}

async function sharePayment(){

let canvas=document.querySelector("#qrcode canvas");
let blob=await new Promise(resolve => canvas.toBlob(resolve,"image/png"));
let file=new File([blob],"QR.png",{type:"image/png"});

let shareURL=baseURL+"?amount="+currentAmount;

let text=
"Karan Payment Gateway\n"+
"Order ID: "+orderId+"\n"+
"Amount: ₹"+currentAmount+"\n"+
shareURL;

if(navigator.canShare && navigator.canShare({files:[file]})){
navigator.share({title:"Karan Payment",text:text,files:[file]});
}else{
window.open("https://wa.me/?text="+encodeURIComponent(text));
}
}

function saveHistory(){

let history=JSON.parse(localStorage.getItem("karanPayments"))||[];

history.push({
orderId:orderId,
amount:currentAmount,
date:new Date().toLocaleString()
});

localStorage.setItem("karanPayments",JSON.stringify(history));
loadHistory();
alert("Saved in history (Demo Mode)");
}

function loadHistory(){

let history=JSON.parse(localStorage.getItem("karanPayments"))||[];
let list=document.getElementById("historyList");
list.innerHTML="";

if(history.length===0){
list.innerHTML="<p>No payments yet</p>";
return;
}

history.reverse().forEach(item=>{
let div=document.createElement("div");
div.className="history-card";
div.innerHTML=
"<b>Order:</b> "+item.orderId+"<br>"+
"<b>Amount:</b> ₹"+item.amount+"<br>"+
"<b>Date:</b> "+item.date;
list.appendChild(div);
});
}

</script>

</body>
</html>
