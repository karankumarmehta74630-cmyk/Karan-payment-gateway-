<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karan Payment Gateway</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
background:linear-gradient(-45deg,#0f172a,#1e3a8a,#9333ea,#0f172a);
background-size:400% 400%;
animation:bg 12s ease infinite;
min-height:100vh;
padding:20px;
display:flex;
justify-content:center;
color:#fff;
}

@keyframes bg{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

.container{max-width:460px;width:100%}

.card{
background:rgba(255,255,255,0.1);
backdrop-filter:blur(15px);
padding:20px;
border-radius:20px;
box-shadow:0 25px 50px rgba(0,0,0,0.4);
margin-bottom:20px;
animation:fade .5s ease;
}

@keyframes fade{
from{opacity:0;transform:translateY(20px)}
to{opacity:1;transform:translateY(0)}
}

.header{
text-align:center;
font-weight:600;
font-size:18px;
margin-bottom:15px;
}

.profile{
background:rgba(255,255,255,0.15);
padding:12px;
border-radius:12px;
margin-bottom:15px;
font-size:13px;
}

input{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:10px;
outline:none;
}

button{
width:100%;
padding:12px;
margin-top:12px;
border:none;
border-radius:10px;
font-weight:600;
cursor:pointer;
background:#1e40af;
color:#fff;
transition:.3s;
}

button:hover{transform:scale(1.03)}

#qrSection{
display:none;
text-align:center;
margin-top:15px;
animation:fade .4s ease;
}

.timer{
color:#ff4d4d;
font-weight:600;
margin-top:8px;
}

.upi-logos{
display:flex;
justify-content:space-around;
margin-top:12px;
}

.upi-logos img{
width:60px;
cursor:pointer;
transition:.3s;
}

.upi-logos img:hover{transform:scale(1.1)}

.history{
font-size:12px;
margin-top:10px;
}

.logout-btn{
background:#dc2626;
margin-top:15px;
}
</style>
</head>
<body>

<div class="container">

<div class="card">

<div class="header">Karan Payment Gateway</div>

<div class="profile" id="profileBox">
Loading...
</div>

<input type="number" id="amount" placeholder="Enter Amount ₹">

<button onclick="generateQR()">Generate QR</button>

<div id="qrSection">

<div id="qrcode"></div>

<p id="orderText"></p>
<p id="amountText"></p>
<p class="timer" id="timer"></p>

<div class="upi-logos">
<img src="https://upload.wikimedia.org/wikipedia/commons/5/5f/Google_Pay_Logo.svg" onclick="openUPI()">
<img src="https://upload.wikimedia.org/wikipedia/commons/1/16/PhonePe_logo.svg" onclick="openUPI()">
<img src="https://upload.wikimedia.org/wikipedia/commons/3/39/Paytm_logo.png" onclick="openUPI()">
</div>

<button onclick="downloadQR()">Download QR</button>
<button onclick="shareQR()">Share QR + Link</button>

<div class="history" id="history"></div>

</div>

<button class="logout-btn" onclick="logout()">Logout</button>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBWfnQ9KFDWA5V9_VfqQdWd-vL-psdcqTA",
  authDomain: "karanchatapp-e0b1d.firebaseapp.com",
  projectId: "karanchatapp-e0b1d",
  appId: "1:992252113506:web:c55091651550918a43173b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let orderId="";
let currentAmount="";
let upiLink="";
let timer;
let timeLeft=60;
let baseURL=window.location.origin+window.location.pathname;

onAuthStateChanged(auth,user=>{
if(!user){
window.location.href="login.html";
}else{
document.getElementById("profileBox").innerHTML=
"<b>Name:</b> "+(user.displayName || "User")+"<br>"+
"<b>Email:</b> "+user.email;
}
});

window.logout=function(){
signOut(auth).then(()=>window.location.href="login.html");
}

window.generateQR=function(){

let amt=amount.value;
if(!amt || amt<=0){alert("Enter valid amount");return;}

currentAmount=amt;
orderId="ORD"+Date.now();

document.getElementById("qrSection").style.display="block";
document.getElementById("orderText").innerText="Order ID: "+orderId;
document.getElementById("amountText").innerText="Amount: ₹"+amt;

document.getElementById("qrcode").innerHTML="";
new QRCode(document.getElementById("qrcode"),{
text:baseURL+"?amount="+amt,
width:220,
height:220
});

upiLink="upi://pay?pa=7463011305-14@ybl&pn=Karan&am="+amt+"&cu=INR&tn=Order "+orderId;

startTimer();
}

function startTimer(){
timeLeft=60;
updateTimer();
clearInterval(timer);
timer=setInterval(()=>{
timeLeft--;
updateTimer();
if(timeLeft<=0){
clearInterval(timer);
document.getElementById("timer").innerText="Expired";
}
},1000);
}

function updateTimer(){
document.getElementById("timer").innerText="Expires in "+timeLeft+" sec";
}

window.openUPI=function(){
if(timeLeft<=0){alert("QR expired");return;}
window.location.href=upiLink;
}

window.downloadQR=function(){
let canvas=document.querySelector("#qrcode canvas");
let link=document.createElement("a");
link.href=canvas.toDataURL("image/png");
link.download="QR_"+orderId+".png";
link.click();
}

window.shareQR=async function(){
let canvas=document.querySelector("#qrcode canvas");
let blob=await new Promise(resolve=>canvas.toBlob(resolve,"image/png"));
let file=new File([blob],"QR.png",{type:"image/png"});

let text=
"Karan Payment Gateway\n"+
"Order ID: "+orderId+"\n"+
"Amount: ₹"+currentAmount+"\n"+
baseURL+"?amount="+currentAmount;

if(navigator.canShare && navigator.canShare({files:[file]})){
navigator.share({title:"Karan Payment",text:text,files:[file]});
}else{
window.open("https://wa.me/?text="+encodeURIComponent(text));
}
}

</script>

</body>
</html>
